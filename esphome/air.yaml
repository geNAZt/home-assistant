esphome:
  name: air
  friendly_name: Air

esp8266:
  board: d1_mini

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "7TYJiu7ocG4/zls+MuN0klGweN6n+2GRHElcbkAmS/o="
  services: 
    - service: sensair_background_calibrate
      then:
        - senseair.background_calibration: senseair_s
    - service: sensair_background_calibration_result
      then:
        - senseair.background_calibration_result: senseair_s

ota:
  - platform: esphome
    password: "ab5775c4e673e21f2f1d022d57ac0c75"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Air Fallback Hotspot"
    password: "zXBz6kvyGsd9"

captive_portal:
    
  
switch:
  - platform: gpio
    pin: 
      number: D7
    inverted: False
    id: pms_set

interval:
  - interval: 10s
    then:
      - switch.turn_on: pms_set
      - delay: 3s
      - switch.turn_off: pms_set

uart:
  - rx_pin: D5
    tx_pin: D6
    baud_rate: 9600
    id: uart_u1
    debug:
      direction: BOTH
  - rx_pin: D4
    tx_pin: D3
    baud_rate: 9600
    id: uart_u2
    debug: 
      direction: BOTH

sensor:
  - platform: pmsx003
    type: PMS5003T
    uart_id: uart_u1
    pm_2_5:
      id: pm25
      name: "Particulate Matter <2.5Âµm Concentration"
  - platform: senseair
    id: senseair_s
    uart_id: uart_u2
    co2:
      id: co2
      name: "SenseAir CO2 Value"
    update_interval: 10s