name: deltaT_preheat_00_06
unit_of_measurement: "K"
query: >
  SELECT ROUND(GREATEST(t1.value - t0.value, 0), 2) AS value
  FROM
    (
      SELECT s.mean AS value
      FROM statistics_short_term s
      JOIN statistics_meta m ON m.id = s.metadata_id
      WHERE m.statistic_id = 'sensor.inside_temp_mean_now'
        AND s.mean IS NOT NULL
        AND s.start_ts >= UNIX_TIMESTAMP(
              IF(TIME(NOW()) < '06:00:00',
                 DATE_SUB(CURDATE(), INTERVAL 1 DAY),
                 CURDATE())
            )
        AND s.start_ts <  UNIX_TIMESTAMP(
              IF(TIME(NOW()) < '06:00:00',
                 DATE_SUB(CURDATE(), INTERVAL 1 DAY),
                 CURDATE())
            ) + 6*3600
      ORDER BY s.start_ts ASC
      LIMIT 1
    ) t0
  CROSS JOIN
    (
      SELECT s.mean AS value
      FROM statistics_short_term s
      JOIN statistics_meta m ON m.id = s.metadata_id
      WHERE m.statistic_id = 'sensor.inside_temp_mean_now'
        AND s.mean IS NOT NULL
        AND s.start_ts >= UNIX_TIMESTAMP(
              IF(TIME(NOW()) < '06:00:00',
                 DATE_SUB(CURDATE(), INTERVAL 1 DAY),
                 CURDATE())
            )
        AND s.start_ts <  UNIX_TIMESTAMP(
              IF(TIME(NOW()) < '06:00:00',
                 DATE_SUB(CURDATE(), INTERVAL 1 DAY),
                 CURDATE())
            ) + 6*3600
      ORDER BY s.start_ts DESC
      LIMIT 1
    ) t1;
column: "value"